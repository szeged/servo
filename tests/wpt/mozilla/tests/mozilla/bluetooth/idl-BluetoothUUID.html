<!doctype html>
<meta charset="utf-8">
<title></title>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/_mozilla/mozilla/bluetooth/bluetooth-helpers.js"></script>
<script>
'use strict';

test(() => {
  assert_equals(BluetoothUUID.getService(base_alias), base_uuid);
  assert_equals(BluetoothUUID.getCharacteristic(base_alias), base_uuid);
  assert_equals(BluetoothUUID.getDescriptor(base_alias), base_uuid);
}, '0x0 should produce valid UUID.');

test(() => {
  assert_equals(BluetoothUUID.getService(NaN), base_uuid);
  assert_equals(BluetoothUUID.getCharacteristic(NaN), base_uuid);
  assert_equals(BluetoothUUID.getDescriptor(NaN), base_uuid);
}, 'NaN returns basic uuid');

test(() => {
  assert_equals(BluetoothUUID.getService(nine_digits), max_uuid);
  assert_equals(BluetoothUUID.getCharacteristic(nine_digits), max_uuid);
  assert_equals(BluetoothUUID.getDescriptor(nine_digits), max_uuid);
  assert_equals(BluetoothUUID.getService(thirteen_digits), max_uuid);
  assert_equals(BluetoothUUID.getCharacteristic(thirteen_digits), max_uuid);
  assert_equals(BluetoothUUID.getDescriptor(thirteen_digits), max_uuid);
  assert_equals(BluetoothUUID.getService(fourteen_digits), base_uuid);
  assert_equals(BluetoothUUID.getCharacteristic(fourteen_digits), base_uuid);
  assert_equals(BluetoothUUID.getDescriptor(fourteen_digits), base_uuid);
}, 'Values between 0xfffffffff (8 digits) and 0xffffffffffffff (14 digits)' +
   'should return max UUID');

test(() => {
  assert_equals(BluetoothUUID.getService(Infinity), base_uuid);
  assert_equals(BluetoothUUID.getCharacteristic(Infinity), base_uuid);
  assert_equals(BluetoothUUID.getDescriptor(Infinity), base_uuid);
}, 'Infinity returns base UUID');

test(() => {
  assert_equals(BluetoothUUID.getService(deadbeef.alias), deadbeef.uuid);
  assert_equals(BluetoothUUID.getCharacteristic(deadbeef.alias), deadbeef.uuid);
  assert_equals(BluetoothUUID.getDescriptor(deadbeef.alias), deadbeef.uuid);
}, '0xdeadbeef should produce valid UUID.');

test(() => {
  assert_equals(BluetoothUUID.getService(adeadbeef.alias), adeadbeef.uuid);
  assert_equals(BluetoothUUID.getCharacteristic(adeadbeef.alias), adeadbeef.uuid);
  assert_equals(BluetoothUUID.getDescriptor(adeadbeef.alias), adeadbeef.uuid);
}, 'Only first 32bits should be used.');

test(() => {
  assert_equals(BluetoothUUID.getService(basic_uuid), basic_uuid);
  assert_equals(BluetoothUUID.getCharacteristic(basic_uuid), basic_uuid);
  assert_equals(BluetoothUUID.getDescriptor(basic_uuid), basic_uuid);
}, 'A valid UUID String should return the same UUID.');

test(() => {
  assert_throws('SyntaxError', () => BluetoothUUID.getService(all_caps_uuid));
  assert_throws('SyntaxError', () => BluetoothUUID.getCharacteristic(all_caps_uuid));
  assert_throws('SyntaxError', () => BluetoothUUID.getDescriptor(all_caps_uuid));
}, 'A UUID String with uppercase letters is an invalid UUID.');

test(() => {
  assert_throws('SyntaxError', () => BluetoothUUID.getService(string_alias));
  assert_throws('SyntaxError', () => BluetoothUUID.getCharacteristic(string_alias));
  assert_throws('SyntaxError', () => BluetoothUUID.getDescriptor(string_alias));
}, 'A 32bit *String* alias is invalid.');

test(() => {
  assert_throws('SyntaxError', () => BluetoothUUID.getService(invalid_character_uuid));
  assert_throws('SyntaxError', () => BluetoothUUID.getCharacteristic(invalid_character_uuid));
  assert_throws('SyntaxError', () => BluetoothUUID.getDescriptor(invalid_character_uuid));
}, 'A UUID with invalid characters is an invalid UUID.');

test(() => {
  assert_equals(BluetoothUUID.getService(alert_notification.name),
                alert_notification.uuid);
  assert_equals(BluetoothUUID.getCharacteristic(aerobic_heart_rate_lower_limit.name),
                aerobic_heart_rate_lower_limit.uuid);
  assert_equals(BluetoothUUID.getDescriptor(characteristic_extended_properties.name),
                characteristic_extended_properties.uuid);
}, 'A valid UUID from a name.');

test(() => {
  assert_throws('SyntaxError', () => {
    BluetoothUUID.getService(aerobic_heart_rate_lower_limit.name);
  });
  assert_throws('SyntaxError', () => {
    BluetoothUUID.getService(characteristic_extended_properties.name);
  });
  assert_throws('SyntaxError', () => {
    BluetoothUUID.getCharacteristic(alert_notification.name);
  });
  assert_throws('SyntaxError', () => {
    BluetoothUUID.getCharacteristic(characteristic_extended_properties.name);
  });
  assert_throws('SyntaxError', () => {
    BluetoothUUID.getDescriptor(alert_notification.name);
  });
  assert_throws('SyntaxError', () => {
    BluetoothUUID.getDescriptor(aerobic_heart_rate_lower_limit.name);
  });
}, 'Make sure attributes don\'t share a map');

test(() => {
  assert_throws('SyntaxError', () => BluetoothUUID.getService(wrong.name));
  assert_throws('SyntaxError', () => BluetoothUUID.getCharacteristic(wrong.name));
  assert_throws('SyntaxError', () => BluetoothUUID.getDescriptor(wrong.name));
}, 'Invalid Descriptor name');

test(() => {
  // cannonicalUUID
  assert_throws(new TypeError, () => BluetoothUUID.canonicalUUID(object));
  // [] converts to '', which converts to 0 before the range check.
  assert_equals(BluetoothUUID.canonicalUUID(array), base_uuid);
  assert_throws(new TypeError, () => BluetoothUUID.canonicalUUID(func));
  assert_throws(new TypeError, () => BluetoothUUID.canonicalUUID(undefined));
  assert_equals(BluetoothUUID.canonicalUUID(null), base_uuid);
  assert_equals(BluetoothUUID.canonicalUUID(false), base_uuid);
  assert_equals(BluetoothUUID.canonicalUUID(true), BluetoothUUID.canonicalUUID(1));
  assert_throws(new TypeError, () => BluetoothUUID.canonicalUUID(NaN));
  // getService
  assert_throws('SyntaxError', () => BluetoothUUID.getService(object));
  assert_throws('SyntaxError', () => BluetoothUUID.getService(array));
  assert_throws('SyntaxError', () => BluetoothUUID.getService(func));
  assert_throws('SyntaxError', () => BluetoothUUID.getService(undefined));
  assert_throws('SyntaxError', () => BluetoothUUID.getService(null));
  assert_throws('SyntaxError', () => BluetoothUUID.getService(false));
  // getCharacteristic
  assert_throws('SyntaxError', () => BluetoothUUID.getCharacteristic(object));
  assert_throws('SyntaxError', () => BluetoothUUID.getCharacteristic(array));
  assert_throws('SyntaxError', () => BluetoothUUID.getCharacteristic(func));
  assert_throws('SyntaxError', () => BluetoothUUID.getCharacteristic(undefined));
  assert_throws('SyntaxError', () => BluetoothUUID.getCharacteristic(null));
  assert_throws('SyntaxError', () => BluetoothUUID.getCharacteristic(false));
  // getDescriptor
  assert_throws('SyntaxError', () => BluetoothUUID.getDescriptor(object));
  assert_throws('SyntaxError', () => BluetoothUUID.getDescriptor(array));
  assert_throws('SyntaxError', () => BluetoothUUID.getDescriptor(func));
  assert_throws('SyntaxError', () => BluetoothUUID.getDescriptor(undefined));
  assert_throws('SyntaxError', () => BluetoothUUID.getDescriptor(null));
  assert_throws('SyntaxError', () => BluetoothUUID.getDescriptor(false));
}, 'Non-number and non-strings');
</script>
